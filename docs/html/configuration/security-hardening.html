<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Security Hardening - Moonsurf Documentation</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Poltawski+Nowy:wght@400;500;600;700&display=block" as="style">
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=block" as="style">
  <link rel="stylesheet" href="../assets/styles.css">
</head>
<body>
  <nav class="sidebar">
  <div class="sidebar-header">
    <a href="../index.html" class="logo">Moonsurf</a>
  </div>
  <ul class="nav-list">
    <li><a href="../index.html">Moonsurf Browser Control Documentation</a></li>
    <li class="nav-section">
      <span class="section-title"><i data-lucide="rocket"></i>Getting Started</span>
      <ul class="section-items">
        <li><a href="../getting-started/README.html">Overview</a></li>
        <li><a href="../getting-started/connecting-ai-clients.html">Connecting AI Clients</a></li>
        <li><a href="../getting-started/first-automation.html">First Automation</a></li>
        <li><a href="../getting-started/installation.html">Installation</a></li>
      </ul>
    </li>
    <li class="nav-section">
      <span class="section-title"><i data-lucide="lightbulb"></i>Concepts</span>
      <ul class="section-items">
        <li><a href="../concepts/README.html">Overview</a></li>
        <li><a href="../concepts/architecture.html">Architecture</a></li>
        <li><a href="../concepts/browser-modes.html">Browser Modes</a></li>
        <li><a href="../concepts/extension-communication.html">Extension Communication</a></li>
        <li><a href="../concepts/instance-lifecycle.html">Instance Lifecycle</a></li>
        <li><a href="../concepts/mcp-protocol.html">MCP Protocol</a></li>
      </ul>
    </li>
    <li class="nav-section">
      <span class="section-title"><i data-lucide="wrench"></i>Tools</span>
      <ul class="section-items">
        <li><a href="../tools/README.html">Overview</a></li>
        <li><a href="../tools/browser-content.html">browser_content</a></li>
        <li><a href="../tools/browser-debug.html">browser_debug</a></li>
        <li><a href="../tools/browser-emulate.html">browser_emulate</a></li>
        <li><a href="../tools/browser-execute.html">browser_execute</a></li>
        <li><a href="../tools/browser-instance.html">browser_instance</a></li>
        <li><a href="../tools/browser-interact.html">browser_interact</a></li>
        <li><a href="../tools/browser-navigate.html">browser_navigate</a></li>
        <li><a href="../tools/browser-network.html">browser_network</a></li>
        <li><a href="../tools/browser-tab.html">browser_tab</a></li>
      </ul>
    </li>
    <li class="nav-section open">
      <span class="section-title"><i data-lucide="settings"></i>Configuration</span>
      <ul class="section-items">
        <li><a href="../configuration/README.html">Overview</a></li>
        <li><a href="../configuration/authentication.html">Authentication</a></li>
        <li><a href="../configuration/environment-variables.html">Environment Variables</a></li>
        <li><a href="../configuration/local-mode.html">Local Mode</a></li>
        <li><a href="../configuration/remote-mode.html">Remote Mode</a></li>
        <li><a href="../configuration/security-hardening.html" class="active">Security Hardening</a></li>
        <li><a href="../configuration/tls-setup.html">TLS Setup</a></li>
      </ul>
    </li>
    <li class="nav-section">
      <span class="section-title"><i data-lucide="book-open"></i>Guides</span>
      <ul class="section-items">
        <li><a href="../guides/README.html">Overview</a></li>
        <li><a href="../guides/debugging-tips.html">Debugging Tips Guide</a></li>
        <li><a href="../guides/file-downloads.html">File Downloads Guide</a></li>
        <li><a href="../guides/form-filling.html">Form Filling Guide</a></li>
        <li><a href="../guides/handling-popups.html">Handling Popups Guide</a></li>
        <li><a href="../guides/network-interception.html">Network Interception Guide</a></li>
        <li><a href="../guides/testing-workflows.html">Testing Workflows Guide</a></li>
        <li><a href="../guides/web-scraping.html">Web Scraping Guide</a></li>
      </ul>
    </li>
    <li class="nav-section">
      <span class="section-title"><i data-lucide="plug"></i>Integration</span>
      <ul class="section-items">
        <li><a href="../integration/README.html">Overview</a></li>
        <li><a href="../integration/ci-cd.html">CI/CD Integration</a></li>
        <li><a href="../integration/claude-code.html">Claude Code Integration</a></li>
        <li><a href="../integration/claude-desktop.html">Claude Desktop Integration</a></li>
        <li><a href="../integration/cursor.html">Cursor Integration</a></li>
        <li><a href="../integration/custom-clients.html">Custom Client Integration</a></li>
      </ul>
    </li>
    <li class="nav-section">
      <span class="section-title"><i data-lucide="code"></i>Api Reference</span>
      <ul class="section-items">
        <li><a href="../api-reference/README.html">Overview</a></li>
        <li><a href="../api-reference/error-codes.html">Error Codes</a></li>
        <li><a href="../api-reference/http-endpoints.html">HTTP Endpoints</a></li>
        <li><a href="../api-reference/sse-protocol.html">SSE Protocol</a></li>
        <li><a href="../api-reference/websocket-protocol.html">WebSocket Protocol</a></li>
      </ul>
    </li>
    <li class="nav-section">
      <span class="section-title"><i data-lucide="list-checks"></i>Tasks</span>
      <ul class="section-items">
        <li><a href="../tasks/README.html">Overview</a></li>
        <li><a href="../tasks/architecture.html">Architecture Overview</a></li>
        <li><a href="../tasks/configuration.html">Configuration</a></li>
        <li><a href="../tasks/contributing.html">Contributing</a></li>
        <li><a href="../tasks/error-handling.html">Error Handling</a></li>
        <li><a href="../tasks/examples.html">Examples</a></li>
        <li><a href="../tasks/getting-started.html">Getting Started</a></li>
        <li><a href="../tasks/internals.html">Internals</a></li>
        <li><a href="../tasks/rest-api.html">REST API Reference</a></li>
        <li><a href="../tasks/task-format.html">Task Format</a></li>
        <li><a href="../tasks/websocket-api.html">WebSocket API Reference</a></li>
      </ul>
    </li>
    <li class="nav-section">
      <span class="section-title"><i data-lucide="terminal"></i>Development</span>
      <ul class="section-items">
        <li><a href="../development/README.html">Overview</a></li>
        <li><a href="../development/adding-tools.html">Adding Tools</a></li>
        <li><a href="../development/debugging.html">Debugging</a></li>
        <li><a href="../development/extension-development.html">Extension Development</a></li>
        <li><a href="../development/internals.html">Internals</a></li>
        <li><a href="../development/local-setup.html">Local Development Setup</a></li>
        <li><a href="../development/project-structure.html">Project Structure</a></li>
        <li><a href="../development/release-process.html">Release Process</a></li>
        <li><a href="../development/testing.html">Testing</a></li>
      </ul>
    </li>
  </ul>
  <div class="sidebar-footer">
    <div class="version">v2.0.0</div>
    <div class="generated">Generated 2026-01-26</div>
  </div>
</nav>

  <main class="content">
    <article>
      <h1>Security Hardening</h1>
<p>Additional security measures for production Moonsurf deployments.</p>
<h2>Security Features Overview</h2>
<div class="table-wrapper"><table><thead><tr><th>Feature</th><th>Purpose</th><th>Default (Remote)</th></tr></thead><tbody><tr><td>Authentication</td><td>Verify client identity</td><td>Enabled</td></tr><tr><td>TLS</td><td>Encrypt traffic</td><td>Disabled (use proxy)</td></tr><tr><td>Rate Limiting</td><td>Prevent abuse</td><td>Enabled</td></tr><tr><td>CORS</td><td>Control cross-origin access</td><td>Enabled</td></tr><tr><td>Audit Logging</td><td>Track security events</td><td>Enabled</td></tr></tbody></table></div><h2>Rate Limiting</h2>
<p>Prevents abuse by limiting requests per IP address.</p>
<h3>Configuration</h3>
<pre><code class="language-bash">RATE_LIMIT_ENABLED=true \
RATE_LIMIT_MAX_CONNECTIONS=10 \
RATE_LIMIT_MAX_CALLS=100 \
moonsurf</code></pre><h3>Settings</h3>
<div class="table-wrapper"><table><thead><tr><th>Variable</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>RATE_LIMIT_ENABLED</code></td><td>Enable rate limiting</td><td><code>true</code> (remote)</td></tr><tr><td><code>RATE_LIMIT_MAX_CONNECTIONS</code></td><td>Max connections per IP</td><td><code>10</code></td></tr><tr><td><code>RATE_LIMIT_MAX_CALLS</code></td><td>Max calls per minute per IP</td><td><code>100</code></td></tr></tbody></table></div><h3>Behavior</h3>
<p>When rate limited:</p>
<pre><code class="language-http">HTTP/1.1 429 Too Many Requests
Retry-After: 45

{&quot;error&quot;: &quot;Too many requests&quot;, &quot;retryAfter&quot;: 45}</code></pre><h3>Recommendations</h3>
<ul>
<li><strong>API clients</strong>: 50-100 calls/minute</li>
<li><strong>Interactive use</strong>: 100-200 calls/minute</li>
<li><strong>Shared IP (NAT)</strong>: Higher limits</li>
</ul>
<h2>CORS Configuration</h2>
<p>Controls which origins can access the server.</p>
<h3>Configuration</h3>
<pre><code class="language-bash">CORS_ENABLED=true \
CORS_ORIGINS=https://app.example.com,https://admin.example.com \
CORS_CREDENTIALS=true \
moonsurf</code></pre><h3>Settings</h3>
<div class="table-wrapper"><table><thead><tr><th>Variable</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>CORS_ENABLED</code></td><td>Enable CORS handling</td><td><code>true</code> (remote)</td></tr><tr><td><code>CORS_ORIGINS</code></td><td>Allowed origins</td><td>Empty (all allowed)</td></tr><tr><td><code>CORS_CREDENTIALS</code></td><td>Allow credentials</td><td><code>true</code></td></tr></tbody></table></div><h3>Recommendations</h3>
<ul>
<li><strong>Specify origins</strong> in production</li>
<li><strong>Avoid wildcards</strong> for sensitive deployments</li>
<li><strong>Enable credentials</strong> only if needed</li>
</ul>
<h3>Example</h3>
<p>Restrict to specific applications:</p>
<pre><code class="language-bash">CORS_ORIGINS=https://claude.ai,https://cursor.sh</code></pre><h2>Audit Logging</h2>
<p>Track security-relevant events for compliance and forensics.</p>
<h3>Configuration</h3>
<pre><code class="language-bash">AUDIT_LOG_ENABLED=true moonsurf</code></pre><h3>Logged Events</h3>
<div class="table-wrapper"><table><thead><tr><th>Event</th><th>Description</th></tr></thead><tbody><tr><td><code>SSE_CONNECTED</code></td><td>Client connected</td></tr><tr><td><code>SSE_DISCONNECTED</code></td><td>Client disconnected</td></tr><tr><td><code>AUTH_FAILED</code></td><td>Authentication failure</td></tr><tr><td><code>RATE_LIMITED</code></td><td>Client rate limited</td></tr><tr><td><code>MCP_REQUEST</code></td><td>MCP method called</td></tr><tr><td><code>EXTENSION_REGISTERED</code></td><td>Browser extension connected</td></tr><tr><td><code>TASK_SUBMITTED</code></td><td>Task created</td></tr><tr><td><code>TASK_CANCELLED</code></td><td>Task cancelled</td></tr></tbody></table></div><h3>Log Format</h3>
<pre><code class="language-json">{
  &quot;timestamp&quot;: &quot;2024-01-15T10:30:00.000Z&quot;,
  &quot;action&quot;: &quot;AUTH_FAILED&quot;,
  &quot;ip&quot;: &quot;1.2.3.4&quot;,
  &quot;path&quot;: &quot;/sse&quot;
}</code></pre><h3>Log Collection</h3>
<p>Send logs to a log aggregation service:</p>
<pre><code class="language-bash"># With Docker
docker run moonsurf 2&gt;&amp;1 | tee /var/log/moonsurf/audit.log

# With systemd
StandardOutput=append:/var/log/moonsurf/stdout.log
StandardError=append:/var/log/moonsurf/stderr.log</code></pre><h2>Network Security</h2>
<h3>Firewall Configuration</h3>
<p>Only expose the HTTP port:</p>
<pre><code class="language-bash"># UFW (Ubuntu)
ufw allow 3300/tcp
ufw deny 3301:3399/tcp  # Block WebSocket ports
ufw deny 3400/tcp       # Block task WebSocket

# iptables
iptables -A INPUT -p tcp --dport 3300 -j ACCEPT</code></pre><h3>WebSocket Ports</h3>
<p>WebSocket ports (3301-3399) should <strong>never</strong> be exposed:</p>
<ul>
<li>They&#39;re for localhost browser communication only</li>
<li>No authentication on these ports</li>
<li>Exposing them is a security risk</li>
</ul>
<h3>Reverse Proxy</h3>
<p>Always use a reverse proxy in production:</p>
<pre><code class="language-plaintext">Internet ──► Nginx/Caddy ──► Moonsurf (localhost)
                 │
                 └── TLS termination
                 └── Additional security headers
                 └── Request filtering</code></pre><h2>Secure Headers</h2>
<p>Configure your reverse proxy to add security headers:</p>
<pre><code class="language-nginx">add_header X-Content-Type-Options &quot;nosniff&quot; always;
add_header X-Frame-Options &quot;DENY&quot; always;
add_header X-XSS-Protection &quot;1; mode=block&quot; always;
add_header Referrer-Policy &quot;strict-origin-when-cross-origin&quot; always;</code></pre><h2>Token Security</h2>
<h3>Token Generation</h3>
<p>Use cryptographically secure tokens:</p>
<pre><code class="language-bash"># 32-byte hex (64 characters)
openssl rand -hex 32

# Or with Node.js
node -e &quot;console.log(require(&#039;crypto&#039;).randomBytes(32).toString(&#039;hex&#039;))&quot;</code></pre><h3>Token Storage</h3>
<ul>
<li>Use environment variables or secrets management</li>
<li>Never commit tokens to version control</li>
<li>Rotate tokens periodically</li>
</ul>
<h3>Token Rotation</h3>
<p>Zero-downtime rotation:</p>
<ol>
<li>Add new token: <code>AUTH_TOKENS=old-token,new-token</code></li>
<li>Update clients to use new token</li>
<li>Remove old token: <code>AUTH_TOKENS=new-token</code></li>
</ol>
<h2>Docker Security</h2>
<h3>Non-root User</h3>
<pre><code class="language-dockerfile">FROM node:20-slim

# Create non-root user
RUN useradd -m moonsurf
USER moonsurf

# Install and run
RUN npm install -g @moonsurf/browser-control
CMD [&quot;moonsurf&quot;]</code></pre><h3>Read-only Filesystem</h3>
<pre><code class="language-yaml">services:
  moonsurf:
    image: moonsurf
    read_only: true
    tmpfs:
      - /tmp</code></pre><h3>Resource Limits</h3>
<pre><code class="language-yaml">services:
  moonsurf:
    image: moonsurf
    deploy:
      resources:
        limits:
          cpus: &#039;2&#039;
          memory: 4G</code></pre><h2>Monitoring and Alerting</h2>
<h3>Health Check Monitoring</h3>
<pre><code class="language-bash"># Simple health check
curl -f http://localhost:3300/health || exit 1

# With expected response
curl -s http://localhost:3300/health | jq -e &#039;.status == &quot;ok&quot;&#039;</code></pre><h3>Alert Conditions</h3>
<p>Monitor for:</p>
<ul>
<li>Authentication failures spike</li>
<li>Rate limiting triggers</li>
<li>Unusual connection patterns</li>
<li>Server errors</li>
</ul>
<h3>Prometheus Metrics</h3>
<p>Health endpoint provides basic metrics:</p>
<pre><code class="language-json">{
  &quot;connectedInstances&quot;: 5,
  &quot;sseClients&quot;: 10
}</code></pre><h2>Security Checklist</h2>
<h3>Pre-deployment</h3>
<ul>
<li><input disabled="" type="checkbox"> Strong, unique authentication tokens generated</li>
<li><input disabled="" type="checkbox"> TLS enabled (direct or via proxy)</li>
<li><input disabled="" type="checkbox"> Rate limiting configured appropriately</li>
<li><input disabled="" type="checkbox"> CORS origins restricted</li>
<li><input disabled="" type="checkbox"> Firewall rules configured</li>
<li><input disabled="" type="checkbox"> Audit logging enabled</li>
</ul>
<h3>Operations</h3>
<ul>
<li><input disabled="" type="checkbox"> Token rotation schedule established</li>
<li><input disabled="" type="checkbox"> Log aggregation configured</li>
<li><input disabled="" type="checkbox"> Alerting set up for security events</li>
<li><input disabled="" type="checkbox"> Regular security reviews planned</li>
<li><input disabled="" type="checkbox"> Incident response plan documented</li>
</ul>
<h3>Development</h3>
<ul>
<li><input disabled="" type="checkbox"> Tokens never committed to version control</li>
<li><input disabled="" type="checkbox"> Development uses different tokens than production</li>
<li><input disabled="" type="checkbox"> Security testing included in CI/CD</li>
</ul>
<h2>Production Configuration Example</h2>
<pre><code class="language-bash"># Server
REMOTE_MODE=true
PORT=3300
PUBLIC_URL=https://mcp.example.com

# Authentication
AUTH_ENABLED=true
AUTH_TOKENS=prod-token-claude-abc123,prod-token-api-xyz789

# TLS (if not using proxy)
TLS_ENABLED=true
TLS_CERT_PATH=/etc/letsencrypt/live/mcp.example.com/fullchain.pem
TLS_KEY_PATH=/etc/letsencrypt/live/mcp.example.com/privkey.pem

# Security
RATE_LIMIT_ENABLED=true
RATE_LIMIT_MAX_CALLS=50
CORS_ENABLED=true
CORS_ORIGINS=https://claude.ai,https://app.example.com
AUDIT_LOG_ENABLED=true

# Browser
BROWSER_DEFAULT_MODE=chromium
HEADLESS_DEFAULT=true

# Logging
LOG_LEVEL=info</code></pre><h2>Related</h2>
<ul>
<li><a href="authentication.html">Authentication</a> - Token configuration</li>
<li><a href="tls-setup.html">TLS Setup</a> - HTTPS configuration</li>
<li><a href="remote-mode.html">Remote Mode</a> - Production deployment</li>
</ul>

    </article>
  </main>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    // Initialize Lucide icons
    lucide.createIcons();

    // Initialize syntax highlighting
    hljs.highlightAll();

    // Toggle sections
    document.querySelectorAll('.section-title').forEach(title => {
      title.addEventListener('click', () => {
        title.parentElement.classList.toggle('open');
      });
    });
  </script>
</body>
</html>