<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Debugging - Moonsurf Documentation</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Poltawski+Nowy:wght@400;500;600;700&display=block" as="style">
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=block" as="style">
  <link rel="stylesheet" href="../assets/styles.css">
</head>
<body>
  <nav class="sidebar">
  <div class="sidebar-header">
    <a href="../index.html" class="logo">Moonsurf</a>
  </div>
  <ul class="nav-list">
    <li><a href="../index.html">Moonsurf Browser Control Documentation</a></li>
    <li class="nav-section">
      <span class="section-title"><i data-lucide="rocket"></i>Getting Started</span>
      <ul class="section-items">
        <li><a href="../getting-started/README.html">Overview</a></li>
        <li><a href="../getting-started/connecting-ai-clients.html">Connecting AI Clients</a></li>
        <li><a href="../getting-started/first-automation.html">First Automation</a></li>
        <li><a href="../getting-started/installation.html">Installation</a></li>
      </ul>
    </li>
    <li class="nav-section">
      <span class="section-title"><i data-lucide="lightbulb"></i>Concepts</span>
      <ul class="section-items">
        <li><a href="../concepts/README.html">Overview</a></li>
        <li><a href="../concepts/architecture.html">Architecture</a></li>
        <li><a href="../concepts/browser-modes.html">Browser Modes</a></li>
        <li><a href="../concepts/extension-communication.html">Extension Communication</a></li>
        <li><a href="../concepts/instance-lifecycle.html">Instance Lifecycle</a></li>
        <li><a href="../concepts/mcp-protocol.html">MCP Protocol</a></li>
      </ul>
    </li>
    <li class="nav-section">
      <span class="section-title"><i data-lucide="wrench"></i>Tools</span>
      <ul class="section-items">
        <li><a href="../tools/README.html">Overview</a></li>
        <li><a href="../tools/browser-content.html">browser_content</a></li>
        <li><a href="../tools/browser-debug.html">browser_debug</a></li>
        <li><a href="../tools/browser-emulate.html">browser_emulate</a></li>
        <li><a href="../tools/browser-execute.html">browser_execute</a></li>
        <li><a href="../tools/browser-instance.html">browser_instance</a></li>
        <li><a href="../tools/browser-interact.html">browser_interact</a></li>
        <li><a href="../tools/browser-navigate.html">browser_navigate</a></li>
        <li><a href="../tools/browser-network.html">browser_network</a></li>
        <li><a href="../tools/browser-tab.html">browser_tab</a></li>
      </ul>
    </li>
    <li class="nav-section">
      <span class="section-title"><i data-lucide="settings"></i>Configuration</span>
      <ul class="section-items">
        <li><a href="../configuration/README.html">Overview</a></li>
        <li><a href="../configuration/authentication.html">Authentication</a></li>
        <li><a href="../configuration/environment-variables.html">Environment Variables</a></li>
        <li><a href="../configuration/local-mode.html">Local Mode</a></li>
        <li><a href="../configuration/remote-mode.html">Remote Mode</a></li>
        <li><a href="../configuration/security-hardening.html">Security Hardening</a></li>
        <li><a href="../configuration/tls-setup.html">TLS Setup</a></li>
      </ul>
    </li>
    <li class="nav-section">
      <span class="section-title"><i data-lucide="book-open"></i>Guides</span>
      <ul class="section-items">
        <li><a href="../guides/README.html">Overview</a></li>
        <li><a href="../guides/debugging-tips.html">Debugging Tips Guide</a></li>
        <li><a href="../guides/file-downloads.html">File Downloads Guide</a></li>
        <li><a href="../guides/form-filling.html">Form Filling Guide</a></li>
        <li><a href="../guides/handling-popups.html">Handling Popups Guide</a></li>
        <li><a href="../guides/network-interception.html">Network Interception Guide</a></li>
        <li><a href="../guides/testing-workflows.html">Testing Workflows Guide</a></li>
        <li><a href="../guides/web-scraping.html">Web Scraping Guide</a></li>
      </ul>
    </li>
    <li class="nav-section">
      <span class="section-title"><i data-lucide="plug"></i>Integration</span>
      <ul class="section-items">
        <li><a href="../integration/README.html">Overview</a></li>
        <li><a href="../integration/ci-cd.html">CI/CD Integration</a></li>
        <li><a href="../integration/claude-code.html">Claude Code Integration</a></li>
        <li><a href="../integration/claude-desktop.html">Claude Desktop Integration</a></li>
        <li><a href="../integration/cursor.html">Cursor Integration</a></li>
        <li><a href="../integration/custom-clients.html">Custom Client Integration</a></li>
      </ul>
    </li>
    <li class="nav-section">
      <span class="section-title"><i data-lucide="code"></i>Api Reference</span>
      <ul class="section-items">
        <li><a href="../api-reference/README.html">Overview</a></li>
        <li><a href="../api-reference/error-codes.html">Error Codes</a></li>
        <li><a href="../api-reference/http-endpoints.html">HTTP Endpoints</a></li>
        <li><a href="../api-reference/sse-protocol.html">SSE Protocol</a></li>
        <li><a href="../api-reference/websocket-protocol.html">WebSocket Protocol</a></li>
      </ul>
    </li>
    <li class="nav-section">
      <span class="section-title"><i data-lucide="list-checks"></i>Tasks</span>
      <ul class="section-items">
        <li><a href="../tasks/README.html">Overview</a></li>
        <li><a href="../tasks/architecture.html">Architecture Overview</a></li>
        <li><a href="../tasks/configuration.html">Configuration</a></li>
        <li><a href="../tasks/contributing.html">Contributing</a></li>
        <li><a href="../tasks/error-handling.html">Error Handling</a></li>
        <li><a href="../tasks/examples.html">Examples</a></li>
        <li><a href="../tasks/getting-started.html">Getting Started</a></li>
        <li><a href="../tasks/internals.html">Internals</a></li>
        <li><a href="../tasks/rest-api.html">REST API Reference</a></li>
        <li><a href="../tasks/task-format.html">Task Format</a></li>
        <li><a href="../tasks/websocket-api.html">WebSocket API Reference</a></li>
      </ul>
    </li>
    <li class="nav-section open">
      <span class="section-title"><i data-lucide="terminal"></i>Development</span>
      <ul class="section-items">
        <li><a href="../development/README.html">Overview</a></li>
        <li><a href="../development/adding-tools.html">Adding Tools</a></li>
        <li><a href="../development/debugging.html" class="active">Debugging</a></li>
        <li><a href="../development/extension-development.html">Extension Development</a></li>
        <li><a href="../development/internals.html">Internals</a></li>
        <li><a href="../development/local-setup.html">Local Development Setup</a></li>
        <li><a href="../development/project-structure.html">Project Structure</a></li>
        <li><a href="../development/release-process.html">Release Process</a></li>
        <li><a href="../development/testing.html">Testing</a></li>
      </ul>
    </li>
  </ul>
  <div class="sidebar-footer">
    <div class="version">v2.0.0</div>
    <div class="generated">Generated 2026-01-26</div>
  </div>
</nav>

  <main class="content">
    <article>
      <h1>Debugging</h1>
<p>Guide to debugging Moonsurf during development.</p>
<h2>Debug Logging</h2>
<h3>Enable Debug Mode</h3>
<pre><code class="language-bash">LOG_LEVEL=debug npm start</code></pre><h3>Log Levels</h3>
<div class="table-wrapper"><table><thead><tr><th>Level</th><th>Description</th></tr></thead><tbody><tr><td><code>debug</code></td><td>All messages including internal details</td></tr><tr><td><code>info</code></td><td>Normal operation messages</td></tr><tr><td><code>warn</code></td><td>Warning messages</td></tr><tr><td><code>error</code></td><td>Error messages only</td></tr></tbody></table></div><h3>Debug Output Examples</h3>
<pre><code class="language-plaintext">[Debug] WebSocket message received: {&quot;action&quot;:&quot;click&quot;,&quot;selector&quot;:&quot;#btn&quot;}
[Debug] Tool call: browser_interact, args: {&quot;action&quot;:&quot;click&quot;,&quot;selector&quot;:&quot;#btn&quot;}
[Debug] Routing to instance: inst_abc123
[Debug] Extension response: {&quot;success&quot;:true}
[Debug] Tool call completed in 145ms</code></pre><h2>Server Debugging</h2>
<h3>Startup Issues</h3>
<p><strong>Check port availability:</strong></p>
<pre><code class="language-bash">lsof -i :3300</code></pre><p><strong>Check process:</strong></p>
<pre><code class="language-bash">ps aux | grep node</code></pre><p><strong>Check logs:</strong></p>
<pre><code class="language-bash">npm start 2&gt;&amp;1 | grep -E &quot;(Error|error|ERROR)&quot;</code></pre><h3>Connection Issues</h3>
<p><strong>Health check:</strong></p>
<pre><code class="language-bash">curl -v http://localhost:3300/health</code></pre><p><strong>Check instances:</strong></p>
<pre><code class="language-bash">curl http://localhost:3300/instances</code></pre><p><strong>Check SSE endpoint:</strong></p>
<pre><code class="language-bash">curl -v -N http://localhost:3300/sse</code></pre><h3>Authentication Issues</h3>
<p><strong>Test without auth:</strong></p>
<pre><code class="language-bash">curl http://localhost:3300/instances
# If 401, auth is enabled</code></pre><p><strong>Test with auth:</strong></p>
<pre><code class="language-bash">curl -H &quot;Authorization: Bearer your-token&quot; http://localhost:3300/instances</code></pre><p><strong>Check configured tokens:</strong>
Look in server startup output or check environment:</p>
<pre><code class="language-bash">echo $AUTH_TOKENS</code></pre><h2>Extension Debugging</h2>
<h3>Extension Not Connecting</h3>
<ol>
<li><p><strong>Check browser launched:</strong></p>
<ul>
<li>Look for browser window (if headless=false)</li>
<li>Check server logs for launch message</li>
</ul>
</li>
<li><p><strong>Check extension loaded:</strong></p>
<ul>
<li>Go to <code>chrome://extensions</code> in the browser</li>
<li>Verify Moonsurf extension is present and enabled</li>
</ul>
</li>
<li><p><strong>Check registration:</strong></p>
<ul>
<li>Server logs should show &quot;Extension registered&quot;</li>
<li>Check <code>/instances</code> endpoint</li>
</ul>
</li>
<li><p><strong>Check WebSocket:</strong></p>
<ul>
<li>Server logs should show WebSocket connection</li>
<li>Port should be in range 3301-3399</li>
</ul>
</li>
</ol>
<h3>Extension Console</h3>
<ol>
<li>Go to <code>chrome://extensions</code></li>
<li>Find Moonsurf extension</li>
<li>Click &quot;Service worker&quot; link</li>
<li>DevTools opens with console</li>
</ol>
<h3>Content Script Debugging</h3>
<ol>
<li>Open target web page</li>
<li>Open DevTools (F12)</li>
<li>Go to Console tab</li>
<li>Filter by &quot;Moonsurf&quot; or your extension ID</li>
</ol>
<h3>Extension Errors</h3>
<p>Common errors and solutions:</p>
<p><strong>&quot;Cannot read property of null&quot;</strong></p>
<ul>
<li>Element not found</li>
<li>Page not loaded</li>
<li>Wrong selector</li>
</ul>
<p><strong>&quot;Permission denied&quot;</strong></p>
<ul>
<li>Check manifest permissions</li>
<li>Check URL patterns</li>
</ul>
<p><strong>&quot;Extension context invalidated&quot;</strong></p>
<ul>
<li>Extension was reloaded</li>
<li>Need to restart browser</li>
</ul>
<h2>Tool Execution Debugging</h2>
<h3>Tool Not Found</h3>
<pre><code class="language-bash">curl -X POST http://localhost:3300/message \
  -H &quot;Content-Type: application/json&quot; \
  -d &#039;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:1,&quot;method&quot;:&quot;tools/list&quot;}&#039; | jq &#039;.result.tools[].name&#039;</code></pre><p>Verify tool name is in the list.</p>
<h3>Tool Execution Timeout</h3>
<pre><code class="language-bash">LOG_LEVEL=debug npm start</code></pre><p>Watch for:</p>
<ul>
<li>Tool call start</li>
<li>Extension command sent</li>
<li>Extension response (or timeout)</li>
</ul>
<h3>Tool Returns Error</h3>
<p>Check response structure:</p>
<pre><code class="language-json">{
  &quot;jsonrpc&quot;: &quot;2.0&quot;,
  &quot;id&quot;: 1,
  &quot;result&quot;: {
    &quot;content&quot;: [{&quot;type&quot;: &quot;text&quot;, &quot;text&quot;: &quot;Error: ...&quot;}],
    &quot;isError&quot;: true
  }
}</code></pre><h2>WebSocket Debugging</h2>
<h3>Using wscat</h3>
<pre><code class="language-bash">npm install -g wscat
wscat -c ws://localhost:3301</code></pre><h3>Monitor Messages</h3>
<p>In debug mode, all WebSocket messages are logged:</p>
<pre><code class="language-plaintext">[WebSocket] Message to extension: {...}
[WebSocket] Message from extension: {...}</code></pre><h3>Connection Issues</h3>
<p><strong>Check port:</strong></p>
<pre><code class="language-bash">lsof -i :3301</code></pre><p><strong>Check firewall:</strong></p>
<pre><code class="language-bash"># macOS
sudo pfctl -s rules

# Linux
sudo iptables -L</code></pre><h2>Task Debugging</h2>
<h3>Task Not Starting</h3>
<ol>
<li>Check instance exists</li>
<li>Check task queue isn&#39;t full</li>
<li>Verify task submission response</li>
</ol>
<h3>Task Stuck</h3>
<pre><code class="language-bash">curl http://localhost:3300/tasks/&lt;taskId&gt;</code></pre><p>Check:</p>
<ul>
<li>Status</li>
<li>Current command index</li>
<li>Command status</li>
</ul>
<h3>Task Progress Missing</h3>
<p>Connect to WebSocket and subscribe:</p>
<pre><code class="language-json">{&quot;type&quot;:&quot;subscribe_task&quot;,&quot;taskId&quot;:&quot;&lt;taskId&gt;&quot;}</code></pre><h2>Network Debugging</h2>
<h3>HTTP Requests</h3>
<p>Use verbose curl:</p>
<pre><code class="language-bash">curl -v http://localhost:3300/health</code></pre><h3>View All Requests</h3>
<p>In Chrome DevTools:</p>
<ol>
<li>Open Network tab</li>
<li>Preserve log</li>
<li>Filter by domain</li>
</ol>
<h3>Proxy for Inspection</h3>
<p>Use mitmproxy or similar:</p>
<pre><code class="language-bash">mitmproxy -p 8080
# Configure browser to use proxy</code></pre><h2>Memory and Performance</h2>
<h3>Check Memory Usage</h3>
<pre><code class="language-bash">ps -o pid,rss,command -p $(pgrep -f &quot;node.*moonsurf&quot;)</code></pre><h3>Node.js Heap</h3>
<p>Add to environment:</p>
<pre><code class="language-bash">NODE_OPTIONS=&quot;--max-old-space-size=4096&quot; npm start</code></pre><h3>Profile Performance</h3>
<pre><code class="language-bash">NODE_OPTIONS=&quot;--inspect&quot; npm start</code></pre><p>Then connect Chrome DevTools to <code>chrome://inspect</code>.</p>
<h2>Common Issues</h2>
<h3>Issue: Browser Launches Then Closes</h3>
<p><strong>Causes:</strong></p>
<ul>
<li>Extension failed to load</li>
<li>Invalid extension path</li>
<li>Permission errors</li>
</ul>
<p><strong>Debug:</strong></p>
<pre><code class="language-bash">HEADLESS_DEFAULT=false LOG_LEVEL=debug npm start</code></pre><p>Watch browser for errors.</p>
<h3>Issue: &quot;No browser instance available&quot;</h3>
<p><strong>Causes:</strong></p>
<ul>
<li>No browser launched</li>
<li>Browser disconnected</li>
<li>Wrong instance ID</li>
</ul>
<p><strong>Debug:</strong></p>
<pre><code class="language-bash">curl http://localhost:3300/instances</code></pre><h3>Issue: Element Not Found</h3>
<p><strong>Causes:</strong></p>
<ul>
<li>Wrong selector</li>
<li>Element not loaded yet</li>
<li>Element in iframe</li>
</ul>
<p><strong>Debug:</strong></p>
<ul>
<li>Take screenshot before action</li>
<li>Check selector in browser DevTools</li>
<li>Add wait for selector</li>
</ul>
<h3>Issue: Timeout on Navigation</h3>
<p><strong>Causes:</strong></p>
<ul>
<li>Page slow to load</li>
<li>Network issues</li>
<li>Page never finishes loading</li>
</ul>
<p><strong>Debug:</strong></p>
<ul>
<li>Check network tab</li>
<li>Try with <code>waitUntil: &quot;domcontentloaded&quot;</code></li>
<li>Increase timeout</li>
</ul>
<h3>Issue: Extension Commands Timeout</h3>
<p><strong>Causes:</strong></p>
<ul>
<li>Content script not loaded</li>
<li>Page blocking scripts</li>
<li>Extension crashed</li>
</ul>
<p><strong>Debug:</strong></p>
<ul>
<li>Check extension DevTools</li>
<li>Check content script injection</li>
<li>Try different page</li>
</ul>
<h2>Debug Utilities</h2>
<h3>Pretty Print Responses</h3>
<pre><code class="language-bash">curl ... | jq .</code></pre><h3>Watch Server Logs</h3>
<pre><code class="language-bash">npm start 2&gt;&amp;1 | tee server.log
# Then: tail -f server.log</code></pre><h3>Timestamp Logs</h3>
<pre><code class="language-bash">npm start 2&gt;&amp;1 | while read line; do echo &quot;$(date +%H:%M:%S) $line&quot;; done</code></pre><h3>Filter Logs</h3>
<pre><code class="language-bash">npm start 2&gt;&amp;1 | grep -E &quot;(Error|Tool|WebSocket)&quot;</code></pre><h2>IDE Debugging</h2>
<h3>VS Code</h3>
<p>Create <code>.vscode/launch.json</code>:</p>
<pre><code class="language-json">{
  &quot;version&quot;: &quot;0.2.0&quot;,
  &quot;configurations&quot;: [
    {
      &quot;type&quot;: &quot;node&quot;,
      &quot;request&quot;: &quot;launch&quot;,
      &quot;name&quot;: &quot;Debug Moonsurf&quot;,
      &quot;skipFiles&quot;: [&quot;&lt;node_internals&gt;/**&quot;],
      &quot;program&quot;: &quot;${workspaceFolder}/dist/index.js&quot;,
      &quot;env&quot;: {
        &quot;LOG_LEVEL&quot;: &quot;debug&quot;
      },
      &quot;preLaunchTask&quot;: &quot;npm: build&quot;
    }
  ]
}</code></pre><p>Press F5 to debug with breakpoints.</p>
<h3>Breakpoints</h3>
<p>Set breakpoints in:</p>
<ul>
<li><code>src/http-server.ts</code> - Request handling</li>
<li><code>src/mcp-handler.ts</code> - MCP routing</li>
<li><code>src/tool-definitions.ts</code> - Tool execution</li>
<li><code>src/instance-manager.ts</code> - Instance operations</li>
</ul>
<h2>Related</h2>
<ul>
<li><a href="testing.html">Testing</a> - Test procedures</li>
<li><a href="local-setup.html">Local Setup</a> - Development environment</li>
<li><a href="../guides/debugging-tips.html">Debugging Guide</a> - User-facing debugging</li>
</ul>

    </article>
  </main>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    // Initialize Lucide icons
    lucide.createIcons();

    // Initialize syntax highlighting
    hljs.highlightAll();

    // Toggle sections
    document.querySelectorAll('.section-title').forEach(title => {
      title.addEventListener('click', () => {
        title.parentElement.classList.toggle('open');
      });
    });
  </script>
</body>
</html>